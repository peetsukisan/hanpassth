<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - จัดการเนื้อหา</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="admin.css">
</head>

<body>
    <div class="admin-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" stroke="#2B4ACF" stroke-width="3" />
                        <path d="M12 20C12 15.5817 15.5817 12 20 12C24.4183 12 28 15.5817 28 20" stroke="#2B4ACF"
                            stroke-width="3" stroke-linecap="round" />
                        <circle cx="20" cy="20" r="4" fill="#2B4ACF" />
                    </svg>
                </div>
                <span class="logo-text">Admin Panel</span>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-tab="promotions">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2v4" />
                        <path d="m16.24 7.76-2.12 2.12" />
                        <path d="M20 12h-4" />
                        <path d="m16.24 16.24-2.12-2.12" />
                        <path d="M12 20v-4" />
                        <path d="m7.76 16.24 2.12-2.12" />
                        <path d="M4 12h4" />
                        <path d="m7.76 7.76 2.12 2.12" />
                    </svg>
                    โปรโมชั่น
                </a>
                <a href="#" class="nav-item" data-tab="guides">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z" />
                        <polyline points="14,2 14,8 20,8" />
                        <line x1="16" y1="13" x2="8" y2="13" />
                        <line x1="16" y1="17" x2="8" y2="17" />
                        <line x1="10" y1="9" x2="8" y2="9" />
                    </svg>
                    ขั้นตอนการใช้งาน
                </a>
            </nav>
            <div class="sidebar-footer">
                <a href="index.html" class="nav-item">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" />
                        <polyline points="9,22 9,12 15,12 15,22" />
                    </svg>
                    กลับหน้าหลัก
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Promotions Tab -->
            <div class="tab-content active" id="promotions-tab">
                <div class="content-header">
                    <h1>จัดการโปรโมชั่น</h1>
                    <button class="btn btn-primary" onclick="openPromoModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                        เพิ่มโปรโมชั่น
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ชื่อ</th>
                                <th>Badge</th>
                                <th>สถานะ</th>
                                <th>วันที่สร้าง</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="promotions-table-body">
                            <tr class="loading-row">
                                <td colspan="5">กำลังโหลด...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Guides Tab -->
            <div class="tab-content" id="guides-tab">
                <div class="content-header">
                    <h1>จัดการขั้นตอนการใช้งาน</h1>
                    <button class="btn btn-primary" onclick="openGuideModal()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="12" y1="5" x2="12" y2="19" />
                            <line x1="5" y1="12" x2="19" y2="12" />
                        </svg>
                        เพิ่มขั้นตอน
                    </button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ลำดับ</th>
                                <th>ชื่อ</th>
                                <th>คำอธิบาย</th>
                                <th>สถานะ</th>
                                <th>การจัดการ</th>
                            </tr>
                        </thead>
                        <tbody id="guides-table-body">
                            <tr class="loading-row">
                                <td colspan="5">กำลังโหลด...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Promotion Modal -->
    <div class="modal" id="promo-modal">
        <div class="modal-backdrop" onclick="closePromoModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="promo-modal-title">เพิ่มโปรโมชั่น</h2>
                <button class="modal-close" onclick="closePromoModal()">&times;</button>
            </div>
            <form id="promo-form" onsubmit="savePromotion(event)">
                <input type="hidden" id="promo-id">
                <div class="form-group">
                    <label for="promo-title">ชื่อโปรโมชั่น *</label>
                    <input type="text" id="promo-title" required placeholder="โปรโมชั่นสุดพิเศษ">
                </div>
                <div class="form-group">
                    <label for="promo-subtitle">รายละเอียดย่อ</label>
                    <input type="text" id="promo-subtitle" placeholder="รับเครดิตคืนสูงสุด 20%">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="promo-badge">Badge Text</label>
                        <input type="text" id="promo-badge" placeholder="EVENT">
                    </div>
                    <div class="form-group">
                        <label for="promo-badge-style">Badge Style</label>
                        <select id="promo-badge-style">
                            <option value="default">Default</option>
                            <option value="light">Light</option>
                        </select>
                    </div>
                </div>

                <!-- Background Type Selection -->
                <div class="form-group">
                    <label>พื้นหลัง</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="bg-type" id="bg-type-color" value="color" checked
                                onchange="toggleBgType()">
                            <span>สีพื้น/Gradient</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="bg-type" id="bg-type-image" value="image"
                                onchange="toggleBgType()">
                            <span>รูปภาพ</span>
                        </label>
                    </div>
                </div>

                <!-- Color Background -->
                <div class="form-group" id="bg-color-group">
                    <label for="promo-bg">สีพื้นหลัง (CSS Gradient)</label>
                    <input type="text" id="promo-bg" placeholder="linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)">
                </div>

                <!-- Image Background -->
                <div class="form-group" id="bg-image-group" style="display: none;">
                    <label for="promo-bg-image">URL รูปภาพพื้นหลัง</label>
                    <input type="text" id="promo-bg-image" placeholder="https://example.com/image.jpg">
                    <small class="form-hint">ใช้ URL จาก Imgur, Google Drive, หรือ CDN อื่นๆ</small>
                </div>

                <!-- Display Mode -->
                <div class="form-group">
                    <label for="promo-display-mode">รูปแบบการแสดงผล</label>
                    <select id="promo-display-mode">
                        <option value="text-overlay">แสดงข้อความบนรูป/พื้นหลัง</option>
                        <option value="image-only">แสดงรูปอย่างเดียว (ไม่มีข้อความ)</option>
                    </select>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="promo-card-type">ประเภทการ์ด</label>
                        <select id="promo-card-type" disabled>
                            <option value="banner">Banner (แบบ emart)</option>
                        </select>
                        <input type="hidden" id="promo-card-type-value" value="banner">
                    </div>
                    <div class="form-group">
                        <label for="promo-text-color">สีตัวอักษร</label>
                        <select id="promo-text-color">
                            <option value="light">สีขาว</option>
                            <option value="dark">สีเข้ม</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="promo-description">รายละเอียดเต็ม</label>
                    <textarea id="promo-description" rows="4" placeholder="รายละเอียดโปรโมชั่น..."></textarea>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="promo-start-date">วันที่เริ่ม</label>
                        <input type="date" id="promo-start-date">
                    </div>
                    <div class="form-group">
                        <label for="promo-end-date">วันที่สิ้นสุด</label>
                        <input type="date" id="promo-end-date">
                    </div>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="promo-active" checked>
                        <span>เปิดใช้งาน</span>
                    </label>
                </div>

                <!-- Sections -->
                <div class="form-group sections-group">
                    <label>Sections (เนื้อหาในหน้ารายละเอียด)</label>
                    <div id="promo-sections"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addPromoSection()">
                        + เพิ่ม Section
                    </button>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closePromoModal()">ยกเลิก</button>
                    <button type="submit" class="btn btn-primary">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Guide Modal -->
    <div class="modal" id="guide-modal">
        <div class="modal-backdrop" onclick="closeGuideModal()"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="guide-modal-title">เพิ่มขั้นตอนการใช้งาน</h2>
                <button class="modal-close" onclick="closeGuideModal()">&times;</button>
            </div>
            <form id="guide-form" onsubmit="saveGuide(event)">
                <input type="hidden" id="guide-id">
                <div class="form-row">
                    <div class="form-group" style="flex: 0 0 100px;">
                        <label for="guide-order">ลำดับ *</label>
                        <input type="number" id="guide-order" required min="1" value="1">
                    </div>
                    <div class="form-group">
                        <label for="guide-title">ชื่อ *</label>
                        <input type="text" id="guide-title" required placeholder="สมัครสมาชิก">
                    </div>
                </div>
                <div class="form-group">
                    <label for="guide-description">คำอธิบาย</label>
                    <input type="text" id="guide-description" placeholder="ลงทะเบียนด้วยอีเมลหรือเบอร์โทรศัพท์">
                </div>
                <div class="form-group">
                    <label for="guide-icon">Icon</label>
                    <select id="guide-icon">
                        <option value="user-plus">User Plus (สมัครสมาชิก)</option>
                        <option value="credit-card">Credit Card (บัตร)</option>
                        <option value="star">Star (โปรโมชั่น)</option>
                        <option value="check">Check (สำเร็จ)</option>
                        <option value="settings">Settings (ตั้งค่า)</option>
                        <option value="search">Search (ค้นหา)</option>
                        <option value="gift">Gift (ของขวัญ)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="guide-active" checked>
                        <span>เปิดใช้งาน</span>
                    </label>
                </div>

                <!-- Steps -->
                <div class="form-group sections-group">
                    <label>ขั้นตอนย่อย (แสดงในหน้ารายละเอียด)</label>
                    <div id="guide-steps"></div>
                    <button type="button" class="btn btn-secondary btn-sm" onclick="addGuideStep()">
                        + เพิ่มขั้นตอนย่อย
                    </button>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeGuideModal()">ยกเลิก</button>
                    <button type="submit" class="btn btn-primary">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="db-service.js"></script>
    <script src="admin.js"></script>
</body>

</html>