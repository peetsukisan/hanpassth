<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>รายละเอียดขั้นตอน</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="detail.css">
</head>

<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <a href="index.html" class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="18" stroke="#2B4ACF" stroke-width="3" />
                        <path d="M12 20C12 15.5817 15.5817 12 20 12C24.4183 12 28 15.5817 28 20" stroke="#2B4ACF"
                            stroke-width="3" stroke-linecap="round" />
                        <circle cx="20" cy="20" r="4" fill="#2B4ACF" />
                    </svg>
                </div>
                <span class="logo-text">MyBrand</span>
            </a>

            <nav class="nav-menu">
                <a href="index.html#promotions" class="nav-link">โปรโมชั่น</a>
                <a href="index.html#how-to-use" class="nav-link active">ขั้นตอนการใช้งาน</a>
            </nav>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <div class="breadcrumb-container">
            <a href="index.html">หน้าหลัก</a>
            <span class="separator">/</span>
            <a href="index.html#how-to-use">ขั้นตอนการใช้งาน</a>
            <span class="separator">/</span>
            <span id="breadcrumb-title">รายละเอียด</span>
        </div>
    </nav>

    <!-- Hero Banner -->
    <section class="detail-hero guide-hero" id="detail-hero">
        <div class="hero-content">
            <div class="hero-icon" id="hero-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <line x1="19" x2="19" y1="8" y2="14" />
                    <line x1="22" x2="16" y1="11" y2="11" />
                </svg>
            </div>
            <span class="hero-badge">ขั้นตอนที่ <span id="hero-step-number">1</span></span>
            <h1 class="hero-title" id="hero-title">กำลังโหลด...</h1>
            <p class="hero-subtitle" id="hero-subtitle"></p>
        </div>
    </section>

    <!-- Detail Content -->
    <main class="detail-content">
        <div class="detail-container">
            <!-- Steps List -->
            <div class="detail-section" id="steps-section">
                <h2 class="section-title">ขั้นตอนย่อย</h2>
                <div class="steps-list" id="steps-list">
                    <p>กำลังโหลดข้อมูล...</p>
                </div>
            </div>

            <!-- Navigation -->
            <div class="guide-navigation" id="guide-navigation">
                <a href="#" class="nav-prev" id="nav-prev">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m15 18-6-6 6-6" />
                    </svg>
                    <span>ขั้นตอนก่อนหน้า</span>
                </a>
                <a href="index.html#how-to-use" class="nav-all">ดูทั้งหมด</a>
                <a href="#" class="nav-next" id="nav-next">
                    <span>ขั้นตอนถัดไป</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m9 18 6-6-6-6" />
                    </svg>
                </a>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-container">
            <p>&copy; 2024 MyBrand. All rights reserved.</p>
        </div>
    </footer>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="firebase-config.js"></script>
    <script src="db-service.js"></script>
    <script>
        const iconSvgs = {
            'user-plus': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>',
            'credit-card': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect width="20" height="14" x="2" y="5" rx="2"/><line x1="2" x2="22" y1="10" y2="10"/></svg>',
            'star': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 2v4"/><path d="m16.24 7.76-2.12 2.12"/><path d="M20 12h-4"/><path d="m16.24 16.24-2.12-2.12"/><path d="M12 20v-4"/><path d="m7.76 16.24 2.12-2.12"/><path d="M4 12h4"/><path d="m7.76 7.76 2.12 2.12"/></svg>',
            'check': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22,4 12,14.01 9,11.01"/></svg>',
            'settings': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>',
            'search': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>',
            'gift': '<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></svg>'
        };

        let allGuides = [];

        document.addEventListener('DOMContentLoaded', async () => {
            // Get guide ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const guideId = urlParams.get('id');

            if (!guideId) {
                document.getElementById('hero-title').textContent = 'ไม่พบขั้นตอน';
                return;
            }

            try {
                // Load all guides for navigation
                allGuides = await dbService.getGuides(true);

                const guide = await dbService.getGuide(guideId);

                if (!guide) {
                    document.getElementById('hero-title').textContent = 'ไม่พบขั้นตอน';
                    return;
                }

                // Update page title
                document.title = guide.title + ' - MyBrand';

                // Update breadcrumb
                document.getElementById('breadcrumb-title').textContent = guide.title;

                // Update hero
                document.getElementById('hero-step-number').textContent = guide.order || '1';
                document.getElementById('hero-title').textContent = guide.title;
                document.getElementById('hero-subtitle').textContent = guide.description || '';

                // Update icon
                if (guide.icon && iconSvgs[guide.icon]) {
                    document.getElementById('hero-icon').innerHTML = iconSvgs[guide.icon];
                }

                // Steps
                if (guide.steps && guide.steps.length > 0) {
                    const stepsHtml = guide.steps.map((step, index) => `
                        <div class="step-item">
                            <div class="step-number">${index + 1}</div>
                            <div class="step-content">
                                <h3>${step.title || `ขั้นตอนที่ ${index + 1}`}</h3>
                                <p>${step.content || ''}</p>
                            </div>
                        </div>
                    `).join('');
                    document.getElementById('steps-list').innerHTML = stepsHtml;
                } else {
                    document.getElementById('steps-section').style.display = 'none';
                }

                // Navigation
                setupNavigation(guideId, guide.order);

            } catch (error) {
                console.error('Error loading guide:', error);
                document.getElementById('hero-title').textContent = 'เกิดข้อผิดพลาด';
            }
        });

        function setupNavigation(currentId, currentOrder) {
            const prevGuide = allGuides.find(g => g.order === currentOrder - 1);
            const nextGuide = allGuides.find(g => g.order === currentOrder + 1);

            const prevBtn = document.getElementById('nav-prev');
            const nextBtn = document.getElementById('nav-next');

            if (prevGuide) {
                prevBtn.href = `guide-detail.html?id=${prevGuide.id}`;
            } else {
                prevBtn.style.visibility = 'hidden';
            }

            if (nextGuide) {
                nextBtn.href = `guide-detail.html?id=${nextGuide.id}`;
            } else {
                nextBtn.style.visibility = 'hidden';
            }
        }
    </script>
</body>

</html>